# 貓咪乾物質計算器 - 產品需求文檔 (PRD)

## 1. 產品概述

### 1.1 產品簡介

貓咪乾物質計算器是一個幫助貓咪飼主計算貓糧乾物質含量的工具，用於評估貓糧營養價值並協助飼主做出更好的餵食決策。

### 1.2 核心價值

- 提供準確的乾物質計算功能
- 記錄和管理多隻貓咪的餵食數據
- 跨平台無縫使用體驗
- 數據持久化與卡片式展示

## 2. 功能需求

### 2.1 乾物質計算器功能

**優先級：P0（最高）**

#### 智能貓咪切換功能

- **貓咪選擇器**
  - 下拉選單顯示所有貓咪
  - 切換貓咪時自動載入該貓咪的歷史糧食資料
  - 顯示所有糧食卡片供選擇
- **歷史資料自動填入**
  - 點擊卡片自動填入所有營養成分數據

#### 輸入欄位：

**基本資訊：**

- 貓糧品牌名稱（文字輸入，必填）
- 貓糧產品名稱（文字輸入，必填）

**重量與熱量：**

- \*食物重量（g）（數字輸入，必填）
- 整體熱量（kcal）（數字輸入，可選）
- 單位熱量（kcal/100g）（數字輸入，可選）

**主要營養成分（必填）：**

- \*蛋白質（%）（數字輸入，0-100，必填）
- \*脂肪（%）（數字輸入，0-100，必填）
- \*纖維（%）（數字輸入，0-100，必填）
- \*灰分（%）（數字輸入，0-100，必填）
- \*水分（%）（數字輸入，0-100，必填）

**礦物質成分（可選）：**

- 鈣（%）（數字輸入，可選）
- 磷（%）（數字輸入，可選）
- 鈉（%）（數字輸入，可選）

**輸入驗證規則：**

- 所有百分比欄位總和不可超過 100%
- 必填欄位不可為空
- 數值範圍檢查與格式驗證

#### 計算公式：

```
基礎計算：
乾物質含量 = 100% - 水分含量%

乾物質基準營養成分：
乾物質基準蛋白質 = (蛋白質% / 乾物質含量%) × 100%
乾物質基準脂肪 = (脂肪% / 乾物質含量%) × 100%
乾物質基準纖維 = (纖維% / 乾物質含量%) × 100%
乾物質基準灰分 = (灰分% / 乾物質含量%) × 100%

熱量計算（當提供時）：
實際熱量密度 = 整體熱量(kcal) / 食物重量(g) × 100
蛋白質熱量比 = (乾物質基準蛋白質% × 4 kcal/g) / 單位熱量 × 100%
脂肪熱量比 = (乾物質基準脂肪% × 9 kcal/g) / 單位熱量 × 100%

礦物質比率（當提供時）：
鈣磷比 = 鈣% / 磷%
```

#### 輸出結果：

**主要營養分析：**

- 乾物質含量百分比
- 乾物質基準各營養成分含量（蛋白質、脂肪、纖維、灰分）
- 熱量密度分析（當提供熱量數據時）

**進階分析（當提供礦物質數據時）：**

- 鈣磷比分析
- 鈉含量評估
- 礦物質平衡建議

**營養評估與建議：**

- 營養成分評估（基於 AAFCO 標準）
- 適合的貓咪年齡階段建議
- 餵食建議（基於熱量密度）
- 營養平衡性評分

### 2.2 用戶帳號管理系統

**優先級：P0（最高）**

- **註冊/登錄功能**
  - 電子郵件註冊登錄
  - Google OAuth 登錄
  - 密碼重設功能
- **用戶資料管理**
  - 基本資料（姓名、頭像）
  - 偏好設定（單位、通知設定）

### 2.3 多貓管理功能

**優先級：P0（最高）**

- **貓咪檔案管理**
  - 新增/編輯/刪除貓咪資料
  - 貓咪基本資訊：
    - 姓名
    - 年齡
    - 體重

### 2.4 卡片式數據存儲與展示

**優先級：P1（高）**

#### 計算記錄卡片

- **卡片包含資訊：**
  - 計算時間戳記
  - 貓糧資訊（品牌、產品名稱）
  - 輸入的營養成分數據
  - 計算結果
  - 關聯的貓咪資訊
  - 備註欄位

#### 卡片管理功能

- **排序與篩選：**

  - 按時間排序（最新/最舊）
  - 按貓咪篩選
  - 按貓糧品牌篩選
  - 搜尋功能

- **卡片操作：**
  - 編輯記錄
  - 複製記錄（快速載入到計算器）
  - 刪除記錄
  - 一鍵載入到計算器（自動切換到對應貓咪）

### 2.5 跨平台支援

**優先級：P1（高）**

- **Web 版本（響應式設計）**

  - 桌面瀏覽器支援
  - 平板瀏覽器支援
  - 手機瀏覽器支援

- **Progressive Web App (PWA)**

  - 安裝到主畫面

## 3. 技術架構

### 3.1 前端技術棧

- **框架：** Next.js 14 (React)
- **UI 庫：** Tailwind CSS + shadcn/ui
- **狀態管理：** Zustand
- **表單處理：** React Hook Form + Zod
- **PWA：** next-pwa (基本安裝功能)

### 3.2 後端技術棧

- **API：** Next.js API Routes
- **資料庫：** PostgreSQL (Supabase)
- **ORM：** Supabase Client
- **認證：** Supabase Auth
- **文件上傳：** Supabase Storage

### 3.3 部署與基礎設施（完全免費方案）

- **主機：** Vercel (免費額度)
- **資料庫：** Supabase (免費額度: 500MB 儲存空間)
- **文件儲存：** Supabase Storage (免費額度: 1GB)
- **認證：** Supabase Auth (免費)
- **監控：** Vercel Analytics (免費額度)

## 4. 資料模型設計

### 4.1 用戶表 (Users)

```sql
id: UUID (PK)
email: String (Unique)
name: String
avatar_url: String
created_at: DateTime
updated_at: DateTime
```

### 4.2 貓咪表 (Cats)

```sql
id: UUID (PK)
user_id: UUID (FK)
name: String
age: Integer
weight: Float
created_at: DateTime
updated_at: DateTime
```

### 4.3 計算記錄表 (FoodCalculations)

```sql
id: UUID (PK)
user_id: UUID (FK)
cat_id: UUID (FK, Optional)

-- 基本資訊
brand_name: String
product_name: String

-- 重量與熱量
food_weight: Float (必填)
total_calories: Float (可選)
calories_per_100g: Float (可選)

-- 主要營養成分 (必填)
protein_percent: Float
fat_percent: Float
fiber_percent: Float
ash_percent: Float
moisture_percent: Float

-- 礦物質成分 (可選)
calcium_percent: Float
phosphorus_percent: Float
sodium_percent: Float

-- 計算結果
dry_matter_content: Float
dm_protein: Float
dm_fat: Float
dm_fiber: Float
dm_ash: Float
calorie_density: Float
protein_calorie_ratio: Float
fat_calorie_ratio: Float
calcium_phosphorus_ratio: Float

-- 額外資訊
notes: Text
favorited: Boolean
created_at: DateTime
updated_at: DateTime
```

## 5. 用戶體驗流程

### 5.1 新用戶註冊流程

1. 用戶訪問首頁
2. 點擊「開始使用」
3. 選擇註冊方式（Email/Google）
4. 完成註冊驗證
5. 引導新增第一隻貓咪
6. 完成首次計算

### 5.2 計算流程

**首次計算流程：**

1. 選擇貓咪（必選）
2. 輸入貓糧資訊
3. 輸入營養成分數據
4. 系統自動計算結果
5. 顯示結果與建議
6. 選擇儲存為卡片
7. 可添加備註與標籤

**智能切換貓咪流程：**

1. 在計算器頁面切換貓咪選擇器
2. 系統自動顯示該貓咪的歷史糧食卡片（所有記錄）
3. 用戶可選擇：
   - 點擊歷史卡片快速載入數據
   - 或手動輸入新的糧食資料
4. 修改數據後重新計算
5. 儲存為新卡片或更新現有卡片

### 5.3 卡片管理流程

1. 進入「我的記錄」頁面
2. 瀏覽已保存的計算卡片
3. 使用篩選與搜尋功能
4. 點擊卡片查看詳情

## 6. 開發時程規劃

### Phase 1 - MVP (已完成 ✅)

- [x] 基礎計算器功能
- [x] 用戶註冊登錄
- [x] 基本貓咪管理
- [x] 簡單的記錄保存

### Phase 2 - 功能完善 (已完成 ✅)

- [x] 卡片式展示介面
- [x] 智能貓咪切換功能
- [x] 進階篩選與搜尋
- [x] 手機優先設計
- [x] 底部導航設計

### Phase 3 - 優化與擴展 (已完成 ✅)

- [x] 性能優化
- [x] UI/UX 優化 (淡藍色主題設計)
- [x] 響應式設計優化 (手機優先)
- [x] 貓咪篩選與直接跳轉功能

## 7. 免費額度與擴容計畫

### 7.1 免費額度限制

- **Vercel：** 每月 100GB 頻寬，無限制靜態網站
- **Supabase：** 500MB 資料庫，1GB 檔案儲存，50,000 MAU
- **預估支撐用戶數：** 約 1,000-2,000 活躍用戶

### 7.2 擴容時機與方案

當達到免費額度 80%時：

- **輕量擴容：** 升級 Supabase Pro 方案 ($25/月)
- **完整擴容：**
  - Vercel Pro ($20/月)
  - Supabase Pro ($25/月)
  - 總成本約 $45/月

## 8. 已實現功能總結

### ✅ 核心功能 (100% 完成)

- **完整的乾物質計算器** - 支援所有 AAFCO 標準營養成分計算
- **用戶認證系統** - Supabase Auth 完整實現
- **多貓咪管理** - 新增/編輯/刪除貓咪檔案
- **智能記錄管理** - 卡片式展示，支援篩選、收藏、歷史載入

### ✅ 用戶體驗 (100% 完成)

- **手機優先設計** - 專為手機瀏覽器優化
- **淡藍色主題** - 漸層背景，圓角卡片設計
- **底部導航** - 三頁籤設計：產品、計算機、管理貓咪
- **直接跳轉** - 從貓咪管理直接跳到對應記錄頁面

### ✅ 技術實現 (100% 完成)

- **前端**: Next.js 14 + React 18 + Tailwind CSS
- **後端**: Supabase (PostgreSQL + Auth + Storage)
- **部署**: 準備完成，可直接部署到 Vercel

## 9. 未來發展路線圖

### 短期目標（Ready for Production）

- ✅ MVP 開發完成
- 🎯 部署到生產環境
- 🎯 用戶測試與反饋收集

### 中期目標（3-6 個月）

- 數據分析與用戶行為優化
- 支援更多貓糧品牌預設資料
- PWA 功能增強

### 長期目標（6 個月以上）

- 營養建議智能化
- 與獸醫診所合作整合
- 多寵物種類支援擴展
